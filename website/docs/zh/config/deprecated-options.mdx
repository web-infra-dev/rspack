import { ApiMeta } from '../../../components/ApiMeta';

# 废弃选项

本页面列出了 Rspack 中已被废弃的配置选项。

这些选项仅为向后兼容而保留，不应在新项目中使用。

## experiments.topLevelAwait

- **类型：** `boolean`
- **默认值：** `true`

开启打包 [Top-level await](https://github.com/tc39/proposal-top-level-await) 的支持，`Top-level await` 仅能在 [ModuleType](/config/module-rules#rulestype) 为 `javascript/esm` 的模块中使用。

默认开启，可通过该配置关闭：

```js title="rspack.config.mjs"
export default {
  experiments: {
    topLevelAwait: false,
  },
};
```

:::warning
该配置项已经废弃，将在 Rspack v2.0 中被移除。

未来 `Top-level await` 特性将会始终开启，请从 Rspack 配置中移除此选项。
:::

## experiments.lazyCompilation

<ApiMeta deprecatedVersion="1.5.0" />

用于开启懒编译。

:::warning
该配置项已经废弃，请使用 [lazyCompilation](/config/lazy-compilation) 替代此项。
:::

## experiments.layers

<ApiMeta deprecatedVersion="1.6.0" />

- **类型：** `boolean`
- **默认值：** `true`

控制是否启用 layer 功能，layer 可以为模块图中以一个模块作为起点的子图中的所有模块添加标识符前缀，用来与其他不同 layer 的模块进行区分，比如：

`index.js` 模块的 layer 为默认的 `null`，其 `identifier` 为 `./index.js`，我们为其添加 `layer = 'client'`，其 `identifier` 会变成 `(client)/./index.js`，这时这两个不同 layer 的 `index.js` 会被区分为不同的模块，因为其唯一标识 `identifier` 不一样，最终产物中也会存在这两个模块的产物。

模块默认的 layer 为 `null`，模块默认会继承其父模块的 layer，你可以通过 `entryOptions.layer` 为一个入口模块添加 layer，也可以通过 [`module.rule[].layer`](/config/module-rules#ruleslayer) 为匹配到的模块添加 layer，同时可以通过 [`module.rule[].issuerLayer`](/config/module-rules#rulesissuerlayer) 根据父模块的 layer 进行匹配。

```js title="rspack.config.mjs"
export default {
  experiments: {
    layers: true,
  },
};
```

:::warning
该配置项已经废弃，layers 特性已始终开启，请从 Rspack 配置项中移除此配置。
:::

## experiments.parallelCodeSplitting

<ApiMeta deprecatedVersion="1.6.2" />

- **类型：** `boolean`
- **默认值：** `false`

开启后会启用新的多线程 code splitting 算法，如果你的项目中包含较多的动态引用，并且不包含循环 chunk，开启后可以显著降低 code splitting 阶段耗时。

```js title="rspack.config.mjs"
export default {
  experiments: {
    parallelCodeSplitting: true,
  },
  optimization: {
    removeAvailableModules: true,
  },
};
```

:::warning
该选项已被废弃，在某些包含大量循环 chunk 的边缘情况下会出现严重的性能问题，我们会在未来改进 build_chunk_graph 的性能来替代该选项。
:::

:::warning
当启用 `parallelCodeSplitting` 时，请确保 `optimization.removeAvailableModules` 也被启用（从 1.3.0 版本起，这已默认启用）。

这保持了与旧版本的 code splitting 算法的一致性，旧版算法在内部强制开启 `removeAvailableModules`，并且不受到 `optimization.removeAvailableModules` 控制。
:::

## rules[].loaders

用于传递 Loader 包名与其选项的数组。

:::warning
该选项已被废弃，请改用 [rules[].use](/config/module-rules#rulesuse)。
:::
