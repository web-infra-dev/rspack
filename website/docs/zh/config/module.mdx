import { ApiMeta, Stability } from '../../../components/ApiMeta';
import PropertyType from '@components/PropertyType';
import WebpackLicense from '@components/WebpackLicense';

<WebpackLicense from="https://webpack.docschina.org/configuration/module/" />

# Module

æ¨¡å—ï¼šè¯¥é€‰é¡¹ç”¨äºå†³å®šå¦‚ä½•å¤„ç†ä¸€ä¸ªé¡¹ç›®ä¸­ä¸åŒç±»å‹çš„æ¨¡å—ã€‚

- **ç±»å‹ï¼š** `Object`
- **é»˜è®¤å€¼ï¼š** `{}`

## module.defaultRules

- **ç±»å‹ï¼š** `(Rule | Falsy)[]`

`defaultRules` ç”¨äºé…ç½® Rspack åœ¨å†…éƒ¨é»˜è®¤å¯ç”¨çš„æ¨¡å—è§£æä¸å¤„ç†è§„åˆ™ã€‚è¿™äº›è§„åˆ™æ˜¯è‡ªåŠ¨ç”Ÿæ•ˆçš„ï¼Œç”¨äºç¡®ä¿å¸¸è§èµ„æºç±»å‹ï¼ˆå¦‚ JavaScriptã€JSONã€CSSã€Wasm ç­‰ï¼‰èƒ½å¤Ÿè¢«æ­£å¸¸è§£æå’Œæ‰“åŒ…ã€‚

ä½ å¯ä»¥é€šè¿‡è¯¥é€‰é¡¹æ‰©å±•ã€è¦†å†™æˆ–ç¦ç”¨é»˜è®¤è§„åˆ™ï¼Œä»è€Œå¯¹æ„å»ºè¡Œä¸ºè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

ä¾‹å¦‚ï¼Œæ‰©å±•é»˜è®¤è§„åˆ™ï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    defaultRules: [
      // ä½ å¯ä»¥ä½¿ç”¨ "..." æ¥å¼•ç”¨ Rspack é»˜è®¤çš„è§„åˆ™
      '...',
      // å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰è§„åˆ™
      {
        test: /\.foo$/,
        use: ['foo-loader'],
      },
    ],
  },
};
```

å¦‚æœä½ å¸Œæœ›ç§»é™¤ Rspack æ‰€æœ‰çš„é»˜è®¤è§„åˆ™ï¼Œä½ å¯ä»¥çœç•¥ `"..."`ï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    defaultRules: [],
  },
};
```

:::tip
æŸ¥çœ‹ [æºä»£ç ](https://github.com/web-infra-dev/rspack/blob/main/packages/rspack/src/config/defaults.ts#L453) äº†è§£æ‰€æœ‰çš„é»˜è®¤è§„åˆ™ã€‚
:::

## module.noParse

- **ç±»å‹ï¼š** `string | string[] | RegExp | RegExp[] | ((request: string) => boolean)`
- **é»˜è®¤å€¼ï¼š** `undefined`

åŒ¹é…çš„æ–‡ä»¶ä»£ç ä¸ä¼šè¢« Rspack è½¬æ¢ï¼ŒåŒ…æ‹¬ `module.exports`, `require`, `import` è¿™äº›æ¨¡å—ç³»ç»Ÿç›¸å…³çš„è¯­æ³•ã€‚

ç”¨æ¥å¿½ç•¥é‚£äº›æ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼Œæœ‰æ—¶è¿˜èƒ½æå‡æ€§èƒ½ã€‚

è¯·æ³¨æ„ï¼šè¿™äº›æ–‡ä»¶ä¾ç„¶è¿˜ä¼šè¢«å·²é…ç½®çš„ loaders å¤„ç†ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    noParse: /typescript|watermark-dom/,
  },
};
```

```js title="rspack.config.mjs"
import { createRequire } from 'node:module';

const require = createRequire(import.meta.url);

export default {
  module: {
    noParse: [require.resolve('typescript'), /watermark-dom/],
  },
};
```

```js title="rspack.config.mjs"
export default {
  module: {
    noParse: (request) => /typescript|watermark-dom/.test(request),
  },
};
```

## module.unsafeCache

- **ç±»å‹ï¼š** `boolean | RegExp`

è¿™æ˜¯ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–é€‰é¡¹ï¼Œé€šè¿‡**å‡è®¾åŒ¹é…æ¨¡å—çš„è§£æç»“æœä¸ä¼šå‘ç”Ÿå˜åŒ–**æ¥å‡å°‘ Rspack ä¸­è®°å½•æ¨¡å—è§£æå…³è”æ–‡ä»¶çš„å¼€é”€ã€‚

åœ¨æ¨¡å—è§£æè¿‡ç¨‹ä¸­ï¼ŒRspack éœ€è¦**è®°å½•**å¯èƒ½å½±å“è§£æç»“æœçš„ç›¸å…³æ–‡ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

```js
import 'the-module';
```

Rspack åœ¨è§£æ `the-module` æ—¶ï¼Œé™¤äº†è·å–å®é™…çš„æ¨¡å—è·¯å¾„ï¼Œè¿˜ä¼š**è®°å½•**å…³è”çš„ `package.json`ï¼š

```json
{
  "exports": {
    ".": "./lib/index.js"
  }
}
```

å› ä¸º `package.json` ä¸­çš„ `exports` å­—æ®µå¯èƒ½ä¼šå½±å“æ¨¡å—çš„è§£æè·¯å¾„ã€‚å½“è¿™äº›æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒRspack éœ€è¦é‡æ–°è¿›è¡Œæ¨¡å—è§£æã€‚

å¯ç”¨ `unsafeCache` åï¼ŒåŒ¹é…çš„æ¨¡å—è¢«è®¤ä¸ºæ¨¡å—è§£æç»“æœä¿æŒç¨³å®šï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ•… Rspack å°†ä¸å†è®°å½•ä¸è¿™äº›æ¨¡å—è§£æç›¸å…³è”çš„æ–‡ä»¶ã€‚

`unsafeCache` å­˜åœ¨ä»¥ä¸‹é»˜è®¤è¡Œä¸ºï¼š

- è‹¥ [cache](/config/cache) è¢«ç¦ç”¨ï¼Œå€¼ä¸º `false`
- è‹¥ [cache](/config/cache) å·²å¯ç”¨ï¼š
  - æ¨¡å—æ¥è‡ª `node_modules` ç›®å½•ï¼Œå€¼ä¸º `true`
  - å…¶ä»–æƒ…å†µä¸‹ï¼Œå€¼ä¸º `false`

```js title="rspack.config.mjs"
export default {
  //...
  module: {
    unsafeCache: false,
  },
};
```

:::tip ä¸ Webpack çš„å·®å¼‚
å³ä½¿è®¾ç½® `module.unsafeCache: false`ï¼ŒRspack ä»ä¼šç¼“å­˜ `Dependency` ä¸ `Module` çš„å…³è”å…³ç³»ï¼Œå› ä¸º Rspack åœ¨æ„å»ºæ¨¡å—å›¾æ—¶é‡‡ç”¨å¢é‡ç®—æ³•ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒWebpack ä¼šå®Œå…¨ç¦ç”¨æ¨¡å—å›¾ç¼“å­˜ã€‚

Rspack ä¸ºç¡®ä¿è§£æå‡†ç¡®æ€§ï¼Œåœ¨ç¦ç”¨ `unsafeCache` æ—¶ä¼šå®Œæ•´è®°å½•æ¨¡å—è§£æè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç›¸å…³æ–‡ä»¶ã€‚
:::

:::tip ä¸ `watchOptions.ignored` çš„å…³ç³»
æ–‡ä»¶è®°å½•ï¼šå‘ç”Ÿåœ¨ make é˜¶æ®µï¼Œå­˜å‚¨å…³è”è·¯å¾„å¹¶å»ºè®®ä¸ Dependency çš„ç´¢å¼•ã€‚

æ–‡ä»¶ç›‘å¬ï¼šç¼–è¯‘ç»“æŸåï¼Œè®°å½•çš„æ–‡ä»¶è·¯å¾„ä¼ é€’ç»™ watcherï¼Œå¯é€šè¿‡ `ignored` é…ç½®å¿½ç•¥ç‰¹å®šè·¯å¾„ã€‚

å¢é‡æ„å»ºï¼šwatcher ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–æ—¶ï¼ŒRspack é€šè¿‡è·¯å¾„æ‰¾åˆ°å—å½±å“ Dependencyï¼Œé‡æ–°æ‰§è¡Œæ¨¡å—è§£æã€‚

ä¸¤è€…åœ¨æ¶æ„ä¸Šåˆ†å±‚å¤„ç†ï¼Œå„è‡ªè´Ÿè´£ä¸åŒçš„åŠŸèƒ½é˜¶æ®µã€‚
:::

## module.parser

- **ç±»å‹ï¼š** `Object`
- **é»˜è®¤å€¼ï¼š** `{}`

ä½¿ç”¨ `module.parser` åœ¨ä¸€ä¸ªåœ°æ–¹é…ç½®æ‰€æœ‰è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      // asset æ¨¡å—çš„è§£æå™¨é€‰é¡¹
      asset: {
        dataUrlCondition: {
          maxSize: 16192,
        },
      },
      // javascript æ¨¡å—çš„è§£æå™¨é€‰é¡¹
      javascript: {
        dynamicImportMode: 'lazy',
        dynamicImportPrefetch: false,
        dynamicImportPreload: false,
        url: true,
        importMeta: true,
      },
      // CSS æ¨¡å—çš„è§£æå™¨é€‰é¡¹
      css: {
        namedExports: true,
      },
      // css/auto æ¨¡å—çš„è§£æå™¨é€‰é¡¹
      'css/auto': {
        namedExports: true,
      },
      // css/module æ¨¡å—çš„è§£æå™¨é€‰é¡¹
      'css/module': {
        namedExports: true,
      },
    },
  },
};
```

### module.parser.asset

`asset` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      asset: {
        // options
      },
    },
  },
};
```

### module.parser.asset.dataUrlCondition

- **ç±»å‹ï¼š** `{ maxSize: number }`
- **é»˜è®¤å€¼ï¼š** `{ maxSize: 8096 }`

å¦‚æœå½“å‰æ¨¡å—çš„å°äºç­‰äº `maxSize`ï¼Œé‚£ä¹ˆæ¨¡å—å°†è¢« Base64 ç¼–ç ï¼Œå¦åˆ™æ¨¡å—å°†ä¼šä»¥æ–‡ä»¶å½¢å¼è¢«è¾“å‡ºã€‚è¯¥é€‰é¡¹ä»…èƒ½ä½œç”¨äº [Asset modules](/guide/features/asset-module)ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      asset: {
        dataUrlCondition: {
          // å°äºç­‰äº 4KB çš„æ¨¡å—å°†è¢« Base64 ç¼–ç 
          maxSize: 4 * 1024,
        },
      },
    },
  },
};
```

### module.parser.javascript

`javascript` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        // options
      },
    },
  },
};
```

### module.parser.javascript.commonjsMagicComments

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'false' }]} />
<ApiMeta addedVersion="1.5.6" />

ä¸º CommonJS å¯ç”¨ [Magic comments](/api/runtime-api/module-methods#magic-comments) æ”¯æŒã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        commonjsMagicComments: true,
      },
    },
  },
};
```

ç›®å‰ä»…æ”¯æŒ `webpackIgnore` æ³¨é‡Šï¼š

```js
const x = require(/* webpackIgnore: true */ 'x');
```

### module.parser.javascript.dynamicImportMode

<PropertyType
  type="'lazy' | 'eager' | 'weak' | 'lazy-once'"
  defaultValueList={[{ defaultValue: "'lazy'" }]}
/>

æŒ‡å®šåŠ¨æ€å¯¼å…¥çš„å…¨å±€æ¨¡å¼ï¼Œè¯¦è§[`webpackMode`](/api/runtime-api/module-methods#webpackmode)ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        dynamicImportMode: 'eager',
      },
    },
  },
};
```

### module.parser.javascript.dynamicImportPrefetch

<PropertyType
  type="boolean | number"
  defaultValueList={[{ defaultValue: 'false' }]}
/>

æŒ‡å®šåŠ¨æ€å¯¼å…¥çš„å…¨å±€ prefetchï¼Œè¯¦è§[`webpackPrefetch`](/api/runtime-api/module-methods#webpackprefetch)ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        dynamicImportPrefetch: true,
      },
    },
  },
};
```

### module.parser.javascript.dynamicImportPreload

<PropertyType
  type="boolean | number"
  defaultValueList={[{ defaultValue: 'false' }]}
/>

æŒ‡å®šåŠ¨æ€å¯¼å…¥çš„å…¨å±€ preloadï¼Œè¯¦è§[`webpackPreload`](/api/runtime-api/module-methods#webpackpreload)ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        dynamicImportPreload: true,
      },
    },
  },
};
```

### module.parser.javascript.dynamicImportFetchPriority

<ApiMeta addedVersion="1.0.0" />

<PropertyType
  type="'low' | 'high' | 'auto'"
  defaultValueList={[{ defaultValue: "'auto'" }]}
/>

æŒ‡å®šåŠ¨æ€å¯¼å…¥çš„å…¨å±€ `fetchPriority`ï¼Œè¯¦è§[`webpackFetchPriority`](/api/runtime-api/module-methods#webpackfetchpriority)ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        dynamicImportFetchPriority: 'high',
      },
    },
  },
};
```

### module.parser.javascript.url

<PropertyType
  type="true | false | 'relative' | 'new-url-relative'"
  defaultValueList={[{ defaultValue: 'true' }]}
/>

å¯ç”¨ `new URL()` è¯­æ³•è§£æã€‚

- `true`ï¼šç”ŸæˆåŒ…å«æ ¹ URL çš„ç»å¯¹ URLï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ã€‚
- `'relative'`ï¼šç”Ÿæˆä¸åŒ…å«æ ¹ URL çš„ç›¸å¯¹ URLã€‚
- `'new-url-relative'`ï¼šç›¸å¯¹äºå…¬å…±è·¯å¾„çš„ç›¸å¯¹ URLã€‚

å½“ä½¿ç”¨ `'new-url-relative'` æ—¶ï¼ŒRspack å°†åœ¨ç¼–è¯‘æ—¶è®¡ç®—å‡ºç›¸å¯¹äºå…¬å…±è·¯å¾„çš„ç›¸å¯¹ URLï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        url: 'new-url-relative',
      },
    },
  },
};
```

```js
new URL('./icon.svg', import.meta.url);

// è½¬æ¢æˆ ğŸ‘‡
new URL('./icon[hash].svg', import.meta.url);
```

å½“ä½¿ç”¨ `'relative'` æ—¶ï¼ŒRspack å°†ç”Ÿæˆè¿è¡Œæ—¶ä»£ç ï¼Œä¸º `new URL()` è¯­æ³•è®¡ç®—å‡ºç›¸å¯¹çš„ URLï¼Œç»“æœ URL ä¸­ä¸åŒ…å«æ ¹ URLï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        url: 'relative',
      },
    },
  },
};
```

```html
<!-- ä½¿ç”¨ 'relative' -->
<img src="icon.svg" />

<!-- ä¸ä½¿ç”¨ 'relative' -->
<img src="file:///path/to/project/dist/icon.svg" />
```

### module.parser.javascript.exprContextCritical

<PropertyType
  type="boolean | undefined"
  defaultValueList={[{ defaultValue: 'true' }]}
/>

å¯ç”¨å®Œå…¨åŠ¨æ€ä¾èµ–ï¼ˆ`import(variable)`ï¼‰çš„è­¦å‘Šã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        exprContextCritical: false,
      },
    },
  },
};
```

### module.parser.javascript.wrappedContextCritical

<PropertyType
  type="boolean | undefined"
  defaultValueList={[{ defaultValue: 'false' }]}
/>

å¯ç”¨éƒ¨åˆ†åŠ¨æ€ä¾èµ–ï¼ˆ`import("./path/to/" + variable)`ï¼‰çš„è­¦å‘Šã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        wrappedContextCritical: false,
      },
    },
  },
};
```

### module.parser.javascript.unknownContextCritical

<PropertyType
  type="boolean | undefined"
  defaultValueList={[{ defaultValue: 'true' }]}
/>

åœ¨ä½¿ç”¨ `require` å‡½æ•°æ—¶ï¼Œå¦‚æœæ— æ³•è¿›è¡Œé™æ€åˆ†æï¼ˆ`require(variable)`ï¼‰ï¼Œæ˜¯å¦è¿›è¡Œè­¦å‘Šã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        unknownContextCritical: false,
      },
    },
  },
};
```

### module.parser.javascript.wrappedContextRegExp

<PropertyType
  type="RegExp | undefined"
  defaultValueList={[{ defaultValue: '/.*/' }]}
/>

è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…åŒ…è£¹çš„åŠ¨æ€ä¾èµ–ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        wrappedContextRegExp: /\.js$/,
      },
    },
  },
};
```

### module.parser.javascript.importMeta

<ApiMeta addedVersion="1.0.0-alpha.6" />

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'true' }]} />

æ˜¯å¦è¦è§£ææ›¿æ¢ `import.meta`ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        importMeta: false,
      },
    },
  },
};
```

### module.parser.javascript.exportsPresence

<PropertyType
  type="'error' | 'warn' | 'auto' | false"
  defaultValueList={[{ defaultValue: "'auto'" }]}
/>

å½“ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å¯¼å‡ºæˆ–å­˜åœ¨å†²çªçš„é‡å¯¼å‡ºæ—¶ï¼Œæ˜¯å¦è¿›è¡Œè­¦å‘Šæˆ–æŠ¥é”™ã€‚

- `"error"`ï¼šè¿›è¡ŒæŠ¥é”™ã€‚
- `"warn"`ï¼šè¿›è¡Œè­¦å‘Šã€‚
- `"auto"`ï¼šæ ¹æ®æ¨¡å—æ˜¯å¦ä¸ºä¸¥æ ¼ ESMï¼Œå¦‚æœæ˜¯ä¸¥æ ¼ ESM åˆ™æŠ¥é”™ï¼Œå¦åˆ™è­¦å‘Šã€‚
- `false`ï¼šå…³é—­è¯¥åŠŸèƒ½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        exportsPresence: 'error',
      },
    },
  },
};
```

### module.parser.javascript.importExportsPresence

<PropertyType type="'error' | 'warn' | 'auto' | false" />

å½“ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å¯¼å‡ºæ—¶ï¼Œæ˜¯å¦è¿›è¡Œè­¦å‘Šæˆ–æŠ¥é”™ã€‚é»˜è®¤ä¼šéµå¾ª [module.parser.javascript.exportsPresence](#moduleparserjavascriptexportspresence) çš„é…ç½®ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        importExportsPresence: 'error',
      },
    },
  },
};
```

### module.parser.javascript.reexportExportsPresence

<PropertyType type="'error' | 'warn' | 'auto' | false" />

å½“ä½¿ç”¨äº†å­˜åœ¨å†²çªçš„é‡å¯¼å‡ºæ—¶ï¼Œæ˜¯å¦è¿›è¡Œè­¦å‘Šæˆ–æŠ¥é”™ã€‚é»˜è®¤ä¼šéµå¾ª [module.parser.javascript.exportsPresence](#moduleparserjavascriptexportspresence) çš„é…ç½®ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        reexportExportsPresence: 'error',
      },
    },
  },
};
```

### module.parser.javascript.strictExportPresence

- **ç±»å‹ï¼š** `boolean`

å½“å¯¼å…¥çš„åç§°åœ¨å¯¼å…¥æ¨¡å—ä¸­ä¸å­˜åœ¨æ—¶ï¼Œå‘å‡ºé”™è¯¯è€Œä¸æ˜¯è­¦å‘Šã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        strictExportPresence: true,
      },
    },
  },
};
```

### module.parser.javascript.typeReexportsPresence

<ApiMeta stability={Stability.Experimental} addedVersion="1.4.1" />

- **ç±»å‹ï¼š** `'no-tolerant' | 'tolerant' | 'tolerant-no-check'`
- **é»˜è®¤å€¼ï¼š** `'no-tolerant'`

æ˜¯å¦å®½å®¹é‡å¯¼å‡ºç±»å‹çš„æŠ¥é”™ï¼Œå¸¸è§æœ‰ä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š

```ts
// case 1:
export { TypeA } from './types';
// case 2:
import { TypeB } from './types';
export { TypeB };
```

é‡å¯¼å‡ºç±»å‹æ—¶ï¼Œç”±äº `TypeA`ã€`TypeB` æ˜¯ç±»å‹ï¼Œä½†ä½¿ç”¨åœ¨ `export {}` å€¼ç©ºé—´ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ï¼š

```txt
WARNING in ./re-exports.ts
  âš  ESModulesLinkingWarning: export 'TypeA' (reexported as 'TypeA') was not found in './types' (module has no exports)
   â•­â”€[2:0]
 1 â”‚ // case 1:
 2 â”‚ export { TypeA } from "./types";
   Â· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

WARNING in ./re-exports.ts
  âš  ESModulesLinkingWarning: export 'TypeB' (reexported as 'TypeB') was not found in './types' (module has no exports)
   â•­â”€[5:0]
 3 â”‚ // case 2:
 4 â”‚ import { TypeB } from "./types";
 5 â”‚ export { TypeB };
   Â· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

:::info æ¨èé…åˆ isolatedModules ä½¿ç”¨ Rspack
ä½¿ç”¨ Rspack æ‰“åŒ… TypeScript æ—¶ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èå¼€å¯ tsconfig.json ä¸­çš„ [isolatedModules](https://www.typescriptlang.org/tsconfig/#isolatedModules)ï¼ˆä½¿ç”¨å…¶ä»– bundler æ—¶ä¹Ÿæ¨èå¼€å¯ï¼Œå› ä¸ºè¿™ç¬¦åˆ bundler å¦‚ä½•ç¼–è¯‘ TypeScriptï¼š[.ts æ–‡ä»¶ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œç‹¬ç«‹è¿›è¡Œç¼–è¯‘](/guide/tech/typescript#%E5%BC%80%E5%90%AF-isolatedmodules)ï¼‰ï¼Œæ­¤æ—¶å¯¹äºé‡å¯¼å‡ºç±»å‹ä¼šæ”¶åˆ° TypeScript æç¤ºï¼š`Re-exporting a type when 'isolatedModules' is enabled requires using 'export type'.`ã€‚
:::

- `'no-tolerant'`ï¼šé»˜è®¤è¡Œä¸ºï¼Œä¸ä¼šå¯¹é‡å¯¼å‡ºç±»å‹è¿›è¡Œå®½å®¹å¤„ç†ï¼Œé‡åˆ°ä¸Šè¿°æƒ…å†µä¼šæŠ¥é”™ã€‚
- `'tolerant'`ï¼šä¼šå¯¹é‡å¯¼å‡ºç±»å‹è¿›è¡Œå®½å®¹å¤„ç†ï¼ŒåŒæ—¶æ£€æŸ¥å­æ¨¡å—ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„ç±»å‹å¯¼å‡ºï¼Œç”±äºéœ€è¦æ”¶é›†å­æ¨¡å—ä¸­çš„ç±»å‹å¯¼å‡ºä¿¡æ¯ï¼Œè¯¥é…ç½®éœ€è¦å’Œ builtin:swc-loader çš„ [`collectTypeScriptInfo.typeExports`](/guide/features/builtin-swc-loader#collecttypescriptinfotypeexports) é…åˆä½¿ç”¨ã€‚
- `'tolerant-no-check'`ï¼šä¼šå¯¹é‡å¯¼å‡ºç±»å‹è¿›è¡Œå®½å®¹å¤„ç†ï¼Œä½†ä¸ä¼šæ£€æŸ¥å­æ¨¡å—ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„ç±»å‹å¯¼å‡ºï¼Œæ­¤æ—¶å¯èƒ½å­˜åœ¨è¯¯å°†æœ¬è¯¥æŠ¥é”™çš„åœºæ™¯å®½å®¹æ‰ï¼ˆé€šå¸¸ IDE ä¹Ÿä¼šæœ‰ç›¸åº”æç¤ºï¼‰ï¼Œç”±äºä¸éœ€è¦æ£€æŸ¥å­æ¨¡å—ï¼Œæ‰€ä»¥æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        typeReexportsPresence: 'tolerant',
      },
    },
    rules: [
      {
        test: /\.ts$/,
        use: [
          {
            loader: 'builtin:swc-loader',
            options: {
              jsc: {
                parser: {
                  syntax: 'typescript',
                },
              },
              collectTypeScriptInfo: {
                typeExports: true, // "tolerant" æ¨¡å¼ä¸‹éœ€å¼€å¯ typeExports æ”¶é›†
              },
            },
          },
        ],
      },
    ],
  },
};
```

è¯¦ç»†ç¤ºä¾‹å¯å‚è€ƒï¼š[type reexports presence ç¤ºä¾‹](https://github.com/rstackjs/rstack-examples/tree/main/rspack/type-reexports-presence)

### module.parser.javascript.worker

<ApiMeta addedVersion="1.0.0-alpha.0" />

<PropertyType type="string[] | boolean" />

ä¸º Worker è§£ææä¾›è‡ªå®šä¹‰çš„è¯­æ³•ï¼Œå¸¸ç”¨äºæ”¯æŒ Workletï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        worker: [
          // æ”¯æŒ CSS paintWorklet
          'CSS.paintWorklet.addModule()',
          // æ”¯æŒ AudioWorkletï¼Œæœ€å‰é¢çš„ '*' è¡¨ç¤ºè¯†åˆ«åä¸º 'context' çš„å˜é‡ï¼Œæ¯”å¦‚ï¼š
          // let context = new AudioContext();
          // await context.audioWorklet.addModule(new URL("noise-processor.js", import.meta.url));
          '*context.audioWorklet.addModule()',
          // ç»§æ‰¿é»˜è®¤è¯­æ³•ï¼š["Worker", "SharedWorker", "navigator.serviceWorker.register()", "Worker from worker_threads"]
          '...',
        ],
      },
    },
  },
};
```

> æŸ¥çœ‹ [Web Workers](/guide/features/web-workers) äº†è§£æ›´å¤šã€‚

### module.parser.javascript.overrideStrict

<ApiMeta addedVersion="1.0.0-alpha.4" />

<PropertyType type="'strict' | 'non-strict'" />

å°†æ¨¡å—è¦†ç›–ä¸ºä¸¥æ ¼æ¨¡å¼æˆ–éä¸¥æ ¼æ¨¡å¼ã€‚

è¿™å¯èƒ½ä¼šå½±å“æ¨¡å—çš„è¡Œä¸ºï¼ˆæŸäº›è¡Œä¸ºåœ¨ä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¹‹é—´æœ‰æ‰€ä¸åŒï¼‰ï¼Œå› æ­¤è¯·è°¨æ…é…ç½®æ­¤é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        overrideStrict: 'strict',
      },
    },
  },
};
```

### module.parser.javascript.commonjs

<PropertyType
  type="boolean | { exports?: boolean | 'skipInEsm' }"
  defaultValueList={[{ defaultValue: 'true' }]}
/>

æ§åˆ¶ CommonJS ç›¸å…³çš„è§£æè¡Œä¸ºã€‚`true` ä¼šä¿æŒ Rspack å¯¹ CommonJS å¯¼å‡ºèµ‹å€¼çš„é»˜è®¤è½¬æ¢ï¼›è®¾ç½® `{ exports: 'skipInEsm' }` æ—¶ï¼Œå½“æ¨¡å—ä»¥ ESM æ–¹å¼æ‰§è¡Œä¼šè·³è¿‡å¯¹åº”çš„é‡å†™ï¼Œä»è€Œä¿ç•™åŸå§‹çš„è¿è¡Œæ—¶å‰¯ä½œç”¨ï¼›é…ç½®ä¸º `false` åˆ™å…³é—­æ‰€æœ‰ CommonJS å¯¼å‡ºå¤„ç†ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        commonjs: {
          exports: 'skipInEsm',
        },
      },
    },
  },
};
```

### module.parser.javascript.requireAlias

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'false' }]} />

æ§åˆ¶æ˜¯å¦è§£æå’Œè½¬æ¢ CommonJS `require` å‡½æ•°çš„é‡å‘½åã€‚

å½“è®¾ç½®ä¸º `true` æ—¶ï¼ŒRspack ä¼šè§£æå’Œè½¬æ¢å°† `require` èµ‹å€¼ç»™å˜é‡æˆ–ä½œä¸ºå‚æ•°ä¼ é€’çš„æƒ…å†µï¼ˆä¾‹å¦‚ï¼š`const req = require; req('./module')`ï¼‰ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireAlias: true,
      },
    },
  },
};
```

### module.parser.javascript.requireAsExpression

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'true' }]} />

æ§åˆ¶æ˜¯å¦è§£æä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨çš„ `require`ã€‚

å½“è®¾ç½®ä¸º `false` æ—¶ï¼ŒRspack ä¸ä¼šè§£æä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨çš„ `require`ï¼ˆä¾‹å¦‚ï¼š`const req = require; req('./module')`ï¼‰ã€‚å¦‚æœä»£ç ä¸­ä¸ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireAsExpression: false,
      },
    },
  },
};
```

### module.parser.javascript.requireDynamic

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'true' }]} />

æ§åˆ¶æ˜¯å¦è§£æåŠ¨æ€ `require` è°ƒç”¨ã€‚

å½“è®¾ç½®ä¸º `false` æ—¶ï¼ŒRspack ä¸ä¼šè§£ææ¨¡å—è·¯å¾„ä¸æ˜¯é™æ€å­—ç¬¦ä¸²çš„åŠ¨æ€ `require` è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼š`require(variable)`ï¼‰ã€‚å¦‚æœä»£ç ä¸­ä¸ä½¿ç”¨åŠ¨æ€ requireï¼Œå¯ä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireDynamic: false,
      },
    },
  },
};
```

### module.parser.javascript.requireResolve

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'true' }]} />

æ§åˆ¶æ˜¯å¦è§£æ `require.resolve()` è°ƒç”¨ã€‚

å½“è®¾ç½®ä¸º `false` æ—¶ï¼ŒRspack ä¸ä¼šè§£æ `require.resolve()` è°ƒç”¨ã€‚å¦‚æœä»£ç ä¸­ä¸ä½¿ç”¨ `require.resolve()`ï¼Œå¯ä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireResolve: false,
      },
    },
  },
};
```

### module.parser.javascript.importDynamic

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'true' }]} />

æ§åˆ¶æ˜¯å¦è§£æåŠ¨æ€ `import()` è°ƒç”¨ã€‚

å½“è®¾ç½®ä¸º `false` æ—¶ï¼ŒRspack ä¸ä¼šè§£ææ¨¡å—è·¯å¾„ä¸æ˜¯é™æ€å­—ç¬¦ä¸²çš„åŠ¨æ€ `import()` è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼š`import(variable)`ï¼‰ã€‚å¦‚æœä»£ç ä¸­ä¸ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼Œå¯ä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        importDynamic: false,
      },
    },
  },
};
```

### module.parser.javascript.jsx

<ApiMeta stability={Stability.Experimental} addedVersion="1.5.7" />

<PropertyType type="boolean" defaultValueList={[{ defaultValue: 'false' }]} />

è®© JavaScript è§£æå™¨èƒ½å¤Ÿè¯†åˆ« JSX è¯­æ³•ï¼Œè¿™æ ·è¯­æ³•è§£æå’Œå‹ç¼©ç­‰æµç¨‹å°±å¯ä»¥åœ¨ä¿ç•™ JSX çš„æƒ…å†µä¸‹ç»§ç»­å·¥ä½œã€‚

å½“ä½ åœ¨ loader ä¸­å°† JSX çš„æ¨¡å¼è®¾ç½®ä¸º "preserve"ï¼Œå¸Œæœ›æŠŠ JSX çš„è½¬æ¢ç•™ç»™åç»­å·¥å…·ï¼ˆä¾‹å¦‚è¾“å‡º JSX çš„ç±»åº“æˆ–ä¾èµ–è‡ªå®šä¹‰ JSX runtime çš„åœºæ™¯ï¼‰æ—¶ï¼Œå¯ä»¥å¼€å¯è¯¥é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        jsx: true,
      },
    },
  },
};
```

:::warning
è¯¥é€‰é¡¹ç›®å‰ä»…åœ¨ Rspack ä¸­å®éªŒæ€§æä¾›ï¼Œæœªæ¥å¯èƒ½è°ƒæ•´æˆ–ç§»é™¤ã€‚
:::

### module.parser["javascript/auto"]

`javascript/auto` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ï¼Œå’Œ [`javascript` çš„æ¨¡å—çš„è§£æå™¨é€‰é¡¹](#moduleparserjavascript)ç›¸åŒã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'javascript/auto': {
        // options
      },
    },
  },
};
```

### module.parser["javascript/dynamic"]

`javascript/dynamic` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ï¼Œå’Œ [`javascript` çš„æ¨¡å—çš„è§£æå™¨é€‰é¡¹](#moduleparserjavascript)ç›¸åŒã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'javascript/dynamic': {
        // options
      },
    },
  },
};
```

### module.parser["javascript/esm"]

`javascript/esm` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ï¼Œå’Œ [`javascript` çš„æ¨¡å—çš„è§£æå™¨é€‰é¡¹](#moduleparserjavascript)ç›¸åŒã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'javascript/esm': {
        // options
      },
    },
  },
};
```

### module.parser.json

<ApiMeta addedVersion="1.2.0" />

`json` æ¨¡å—çš„è§£æå™¨é€‰é¡¹

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      json: {
        // options
      },
    },
  },
};
```

### module.parser.json.exportsDepth

<ApiMeta addedVersion="1.2.0" />

- **Type:** `number`
- **Default:** production æ¨¡å¼ä¸º `Number.MAX_SAFE_INTEGER`, development æ¨¡å¼ä¸º `1`

è®¾ç½® Rspack å¯¹äº `json` æ¨¡å—å¯¼å‡ºçš„åˆ†æç¨‹åº¦ã€‚development æ¨¡å¼ä¸‹æ­¤é¡¹é»˜è®¤å€¼ä¸º `1`ï¼Œå¯å¤§å¹…æå‡æ„å»ºæ•ˆç‡ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      json: {
        // ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹ json
        // {
        //   "depth_1": {
        //     "depth_2": {
        //       "depth_3": "foo"
        //     }
        //   },
        //   "_depth_1": "bar"
        // }
        // å½“è®¾ç½® exportsDepth: 1 æ—¶, `depth_2` and `depth_3` å°†ä¸ä¼šè¢«åˆ†æã€‚
        exportsDepth: 1,
      },
    },
  },
};
```

### module.parser["css/auto"]

`css/auto` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'css/auto': {
        // options
      },
    },
  },
};
```

### module.parser["css/auto"].namedExports

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true`

ä½¿ç”¨ ES æ¨¡å—å‘½åå¯¼å‡ºæ¥å¯¼å‡º CSSã€‚

å½“ä½¿ç”¨ `namedExports: true` æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´å¯¼å‡ºæˆ–å‘½åå¯¼å‡ºï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'css/auto': {
        namedExports: true,
      },
    },
  },
};
```

```js
// å‘½åç©ºé—´å¯¼å‡º
import * as classes from './index.module.css';
// å‘½åå¯¼å‡º
import { class1, class2 } from './index.module.css';
```

å½“ä½¿ç”¨ `namedExports: false` æ—¶ï¼Œé™¤äº†å‘½åç©ºé—´å¯¼å‡ºå’Œå‘½åå¯¼å‡ºä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨é»˜è®¤å¯¼å‡ºï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'css/auto': {
        namedExports: false,
      },
    },
  },
};
```

```js
// å‘½åç©ºé—´å¯¼å‡º
import * as classes from './index.module.css';
// å‘½åå¯¼å‡º
import { class1, class2 } from './index.module.css';
// é»˜è®¤å¯¼å‡º
import classes from './index.module.css';
// é»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡º
import classes, { class1, class2 } from './index.module.css';
```

### module.parser["css/auto"].url

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true`

å¼€å¯æˆ–è€…å…³é—­å¯¹ CSS ä¸­çš„ `url` çš„å¤„ç†ã€‚

å½“å¼€å¯è¯¥é€‰é¡¹ `url: true`, Rspack å°† `url` å‡½æ•°ä¸­çš„è·¯å¾„è§£ææˆèµ„æºè·¯å¾„ã€‚
å½“å…³é—­è¯¥é€‰é¡¹ `url: false`, Rspack å¿½ç•¥ `url` å‡½æ•°ï¼Œä¿æŒå†…å®¹ä¸å˜ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      css: {
        url: true,
      },
    },
  },
};
```

### module.parser.css

`css` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      css: {
        // options
      },
    },
  },
};
```

### module.parser.css.namedExports

å’Œ [`module.parser["css/auto"].namedExports`](#moduleparsercssautonamedexports) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      css: {
        namedExports: true,
      },
    },
  },
};
```

### module.parser.css.url

å’Œ [`module.parser["css/auto"].url`](#moduleparsercssautourl) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      css: {
        url: true,
      },
    },
  },
};
```

### module.parser["css/module"]

`css/module` æ¨¡å—çš„è§£æå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'css/module': {
        // options
      },
    },
  },
};
```

### module.parser["css/module"].namedExports

å’Œ [`module.parser["css/auto"].namedExports`](#moduleparsercssautonamedexports) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      'css/module': {
        namedExports: true,
      },
    },
  },
};
```

### module.parser["css/module"].url

å’Œ [`module.parser["css/auto"].url`](#moduleparsercssautourl) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      css: {
        url: true,
      },
    },
  },
};
```

## module.generator

- **ç±»å‹ï¼š** `Object`
- **é»˜è®¤å€¼ï¼š** `{}`

ä½¿ç”¨ `module.generator` åœ¨ä¸€ä¸ªåœ°æ–¹é…ç½®æ‰€æœ‰ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      // asset æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      asset: {
        dataUrl: {
          encoding: false,
          mimetype: 'base64',
        },
        filename: '[name]-[contenthash][ext]',
        publicPath: 'https://cdn.example.com/',
      },
      // asset/inline æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      'asset/inline': {
        dataUrl: {
          encoding: false,
          mimetype: 'base64',
        },
      },
      // asset/resource æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      'asset/resource': {
        filename: '[name]-[contenthash][ext]',
        publicPath: 'https://cdn.example.com/',
      },
      // css/auto æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      'css/auto': {
        exportsConvention: 'as-is',
        exportsOnly: false,
        localIdentName: '[uniqueName]-[id]-[local]',
        esModule: true,
      },
      // `css` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      css: {
        exportsOnly: false,
        esModule: true,
      },
      // css/module æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      'css/module': {
        exportsConvention: 'as-is',
        exportsOnly: false,
        localIdentName: '[uniqueName]-[id]-[local]',
        esModule: true,
      },
      // `json` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹
      json: {
        JSONParse: true,
      },
    },
  },
};
```

### module.generator.asset

`asset` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        // options
      },
    },
  },
};
```

### module.generator.asset.binary

- **ç±»å‹ï¼š** `boolean | undefined`
- **é»˜è®¤å€¼ï¼š** `undefined`

æ˜¯å¦å°† asset è§†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®¾ç½®ä¸º `false` æ—¶æ¨¡å—ä¼šè¢«å½“ä½œæ–‡æœ¬å¤„ç†ã€‚ä¸è®¾ç½®å°†æ ¹æ®æ¨¡å—ç±»å‹è‡ªåŠ¨åˆ¤æ–­ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        binary: false,
      },
    },
  },
};
```

### module.generator.asset.dataUrl

- **ç±»å‹ï¼š** `Object | (source: Buffer, context: { filename: string, module: Module }) => string`
- **é»˜è®¤å€¼ï¼š** `{}`

ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `asset` æˆ– `'asset/inline'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        dataUrl: {
          encoding: 'base64',
          mimetype: 'mimetype/png',
        },
      },
    },
  },
};
```

å½“è¢«ä½œä¸ºä¸€ä¸ªå‡½æ•°ä½¿ç”¨ï¼Œå®ƒå¿…é¡»ä¸ºæ¯ä¸ªæ¨¡å—æ‰§è¡Œä¸”å¹¶é¡»è¿”å›ä¸€ä¸ª data URI å­—ç¬¦ä¸²ã€‚

```js title="rspack.config.mjs"
import { createRequire } from 'node:module';

const require = createRequire(import.meta.url);

export default {
  //...
  module: {
    generator: {
      asset: {
        dataUrl: ({ content }) => {
          const svgToMiniDataURI = require('mini-svg-data-uri');
          return svgToMiniDataURI(content);
        },
      },
    },
  },
};
```

### module.generator.asset.dataUrl.encoding

- **ç±»å‹ï¼š** `false | 'base64'`
- **é»˜è®¤å€¼ï¼š** `'base64'`

è®¾ç½®ä¸º base64 æ—¶ï¼Œæ¨¡å—å°†ä½¿ç”¨ base64 ç®—æ³•è¿›è¡Œç¼–ç ã€‚å°†ç¼–ç è®¾ç½®ä¸º false å°†ç¦ç”¨ç¼–ç ã€‚ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset/inline'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        dataUrl: {
          encoding: false,
        },
      },
    },
  },
};
```

### module.generator.asset.dataUrl.mimetype

- **ç±»å‹ï¼š** `string`
- **é»˜è®¤å€¼ï¼š** `require('mime-types').lookup(ext)`

dataUrl çš„ MIME ç±»å‹ï¼Œé»˜è®¤ä»æ¨¡å—èµ„æºæ‰©å±•åè§£æã€‚ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset/inline'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        dataUrl: {
          mimetype: 'image/png',
        },
      },
    },
  },
};
```

### module.generator.asset.importMode

- **ç±»å‹ï¼š** `'url' | 'preserve'`
- **é»˜è®¤å€¼ï¼š** `'url'`

å¦‚æœä¸º `"url"`ï¼Œå°†åŸºäº [publicPath](#modulegeneratorassetpublicpath) ç”ŸæˆæŒ‡å‘ asset çš„ URLã€‚
å¦‚æœä¸º `"preserve"`ï¼Œå°†ä¿ç•™æŒ‡å‘ asset çš„ import æˆ– require è¯­å¥ã€‚

ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset'` å’Œ `'asset/resource'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

- `'asset'`:

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        importMode: 'preserve',
      },
    },
  },
};
```

- `'asset/resource'`:

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        importMode: 'preserve',
      },
    },
  },
};
```

### module.generator.asset.filename

- **ç±»å‹ï¼š** `string | ((pathData: PathData, assetInfo?: AssetInfo) => string)`
- **é»˜è®¤å€¼ï¼š** `undefined`
- **æ”¯æŒçš„ Template stringï¼š** å‚è€ƒ [`output.assetModuleFilename`](/config/output#outputassetmodulefilename)

è¦†ç›– [`output.assetModuleFilename`](/config/output#outputassetmodulefilename)ï¼Œä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset'` å’Œ `'asset/resource'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        filename: 'static/[hash][ext]',
      },
    },
  },
};
```

### module.generator.asset.outputPath

- **ç±»å‹ï¼š** `string | ((pathData: PathData, assetInfo?: AssetInfo) => string)`
- **é»˜è®¤å€¼ï¼š** `undefined`

å°† asset è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ç›¸å¯¹äº [`output.path`](/config/output#outputpath)ã€‚

ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset'` å’Œ `'asset/resource'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        outputPath: 'foo/',
      },
    },
  },
};
```

### module.generator.asset.publicPath

- **ç±»å‹ï¼š** `string | ((pathData: PathData, assetInfo?: AssetInfo) => string)`
- **é»˜è®¤å€¼ï¼š** `undefined`

è¦†ç›– [`output.publicPath`](/config/output#outputpublicpath)ï¼Œä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset'` å’Œ `'asset/resource'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        publicPath: 'https://cdn.example.com/',
      },
    },
  },
};
```

### module.generator.asset.emit

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true`

æ˜¯å¦å°† asset è¾“å‡ºåˆ°ç£ç›˜ã€‚å¯¹äº SSR ç­‰åœºæ™¯ï¼Œä½ å¯ä»¥å°†è¯¥é€‰é¡¹è®¾ç½®ä¸º `false` æ¥é¿å…è¾“å‡ºæ— ç”¨çš„æ–‡ä»¶ã€‚

ä»…å¯¹æ¨¡å—ç±»å‹ä¸º `'asset'` æˆ– `'asset/resource'` çš„æ¨¡å—ç”Ÿæ•ˆã€‚

- `'asset'`ï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      asset: {
        emit: false,
      },
    },
  },
};
```

- `'asset/resource'`ï¼š

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        emit: false,
      },
    },
  },
};
```

### module.generator["asset/inline"]

`asset/inline` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/inline': {
        // options
      },
    },
  },
};
```

### module.generator["asset/inline"].binary

å’Œ [`module.generator["asset"].binary`](#modulegeneratorassetbinary) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/inline': {
        binary: false,
      },
    },
  },
};
```

### module.generator["asset/inline"].dataUrl

å’Œ [`module.generator["asset"].dataUrl`](#modulegeneratorassetdataurl) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/inline': {
        dataUrl: {
          // options
        },
      },
    },
  },
};
```

### module.generator["asset/inline"].dataUrl.encoding

å’Œ [`module.generator["asset"].dataUrl.encoding`](#modulegeneratorassetdataurlencoding) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/inline': {
        dataUrl: {
          encoding: false,
        },
      },
    },
  },
};
```

### module.generator["asset/inline"].dataUrl.mimetype

å’Œ [`module.generator["asset"].dataUrl.mimetype`](#modulegeneratorassetdataurlmimetype) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/inline': {
        dataUrl: {
          mimetype: 'image/png',
        },
      },
    },
  },
};
```

### module.generator["asset/resource"]

`asset/resource` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        // options
      },
    },
  },
};
```

### module.generator["asset/resource"].binary

å’Œ [`module.generator["asset"].binary`](#modulegeneratorassetbinary) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        binary: false,
      },
    },
  },
};
```

### module.generator["asset/resource"].importMode

å’Œ [`module.generator["asset"].importMode`](#modulegeneratorassetimportmode) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        importMode: 'preserve',
      },
    },
  },
};
```

### module.generator["asset/resource"].filename

å’Œ [`module.generator["asset"].filename`](#modulegeneratorassetfilename) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        filename: 'static/[hash][ext]',
      },
    },
  },
};
```

### module.generator["asset/resource"].outputPath

å’Œ [`module.generator["asset"].outputPath`](#modulegeneratorassetoutputpath) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        outputPath: 'foo/',
      },
    },
  },
};
```

### module.generator["asset/resource"].publicPath

å’Œ [`module.generator["asset"].publicPath`](#modulegeneratorassetpublicpath) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'asset/resource': {
        publicPath: 'https://cdn.example.com/',
      },
    },
  },
};
```

### module.generator["css/auto"]

`css/auto` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/auto': {
        // options
      },
    },
  },
};
```

### module.generator["css/auto"].exportsConvention

- **ç±»å‹ï¼š** `'as-is' | 'camel-case' | 'camel-case-only' | 'dashes' | 'dashes-only'`
- **é»˜è®¤å€¼ï¼š** `'as-is'`

è‡ªå®šä¹‰ CSS å¯¼å‡ºåç§°å¦‚ä½•å¯¼å‡ºåˆ° JavaScript æ¨¡å—ï¼Œä¾‹å¦‚ä¿ç•™åŸæ ·ã€è½¬æ¢ä¸ºé©¼å³°å‘½åç­‰ç­‰ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/auto': {
        exportsConvention: 'camel-case',
      },
    },
  },
};
```

### module.generator["css/auto"].exportsOnly

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true` for node environments, `false` for web environments.

å¦‚æœä¸º `true`ï¼Œä»…ä» CSS ä¸­å¯¼å‡ºæ ‡è¯†ç¬¦æ˜ å°„è¡¨åˆ° JavaScript æ–‡ä»¶ä¸­ï¼Œè€Œä¸åœ¨ template ä¸­æ³¨å…¥ä»»ä½• stylesheetsã€‚é€‚ç”¨äºä½¿ç”¨ CSS Modules è¿›è¡Œé¢„æ¸²æŸ“çš„åœºæ™¯ï¼ˆä¾‹å¦‚ SSRï¼‰ã€‚

å¦‚æœä¸º `false`ï¼Œç”Ÿæˆ stylesheets å¹¶å°†å…¶æ³¨å…¥åˆ° template ä¸­ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/auto': {
        exportsOnly: false,
      },
    },
  },
};
```

### module.generator["css/auto"].localIdentName

- **ç±»å‹ï¼š** `string`
- **é»˜è®¤å€¼ï¼š** `[uniqueName]-[id]-[local]`

è‡ªå®šä¹‰ç”Ÿæˆçš„ CSS Modules çš„å±€éƒ¨ç±»åæ ¼å¼ï¼Œé™¤äº†åœ¨[æ–‡ä»¶çº§åˆ«](/config/output#file-context)å’Œ[æ¨¡å—çº§åˆ«](/config/output#module-context)çš„æ›¿æ¢ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ `[uniqueName]` å’Œ `[local]`ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/auto': {
        localIdentName: '[local]-[hash:base64:6]',
      },
    },
  },
};
```

### module.generator["css/auto"].esModule

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true`

æ˜¯å¦ä¸º CSS çš„å¯¼å‡ºæ·»åŠ  `__esModule`ï¼Œå¦‚æœæ·»åŠ åˆ™ä¼šåœ¨ ESM-CJS interop æ—¶å½“ä½œ ES modulesï¼Œå¦åˆ™å½“ä½œ CommonJS modulesã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/auto': {
        esModule: true,
      },
    },
  },
};
```

æ¯”å¦‚åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶åº“çš„ CommonJS äº§ç‰©æ—¶ï¼Œæœ‰æ—¶éœ€è¦æ·»åŠ è¯¥é…ç½®ç¡®ä¿ ESM-CJS interop æ­£ç¡®ï¼Œä»¥æ‹¿åˆ°æ­£ç¡®çš„å¯¼å‡ºï¼ˆå¯é…åˆ [rules[].test](/config/module-rules#rulestest) ç­‰åŒ¹é…æ¡ä»¶åªä¸ºè¯¥ç»„ä»¶åº“æ·»åŠ ï¼‰ã€‚

ç»„ä»¶åº“æºç ï¼š

```js
import style from './style.css';

export function Button() {
  return <button className={style.btn}></button>;
}
```

ç»„ä»¶åº“å‘å¸ƒçš„ CommonJS äº§ç‰©ï¼š

```js
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true,
});
exports.Button = Button;
var _style = _interopRequireDefault(require('./style.css'));
var _jsxRuntime = require('react/jsx-runtime');
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}
function Button() {
  return /*#__PURE__*/ (0, _jsxRuntime.jsx)('button', {
    className: _style['default'].btn, // <-- æ³¨æ„ï¼šè¿™é‡Œç»è¿‡ _interopRequireDefault åéœ€è¦è®¿é—® default
  });
}
```

### module.generator.css

`css` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      css: {
        // options
      },
    },
  },
};
```

### module.generator.css.exportsOnly

å’Œ [`module.generator["css/auto"].exportsOnly`](#modulegeneratorcssautoexportsonly) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      css: {
        exportsOnly: false,
      },
    },
  },
};
```

### module.generator.css.esModule

å’Œ [`module.generator["css/auto"].esModule`](#modulegeneratorcssautoesmodule) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      css: {
        esModule: true,
      },
    },
  },
};
```

### module.generator["css/module"]

`css/module` æ¨¡å—çš„ç”Ÿæˆå™¨é€‰é¡¹ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/module': {
        // options
      },
    },
  },
};
```

### module.generator["css/module"].exportsConvention

å’Œ [`module.generator["css/auto"].exportsConvention`](#modulegeneratorcssautoexportsconvention) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/module': {
        exportsConvention: 'camel-case',
      },
    },
  },
};
```

### module.generator["css/module"].exportsOnly

å’Œ [`module.generator["css/auto"].exportsOnly`](#modulegeneratorcssautoexportsonly) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/module': {
        exportsOnly: false,
      },
    },
  },
};
```

### module.generator["css/module"].localIdentName

å’Œ [`module.generator["css/auto"].localIdentName`](#modulegeneratorcssautolocalidentname) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/module': {
        localIdentName: '[local]-[hash:base64:6]',
      },
    },
  },
};
```

### module.generator["css/module"].esModule

å’Œ [`module.generator["css/auto"].esModule`](#modulegeneratorcssautoesmodule) ä¸€æ ·ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      'css/module': {
        esModule: true,
      },
    },
  },
};
```

### module.generator.json.JSONParse

- **ç±»å‹ï¼š** `boolean`
- **é»˜è®¤å€¼ï¼š** `true`

å½“ JSON å­—ç¬¦ä¸²é•¿åº¦å¤§äº 20 æ—¶ï¼Œä½¿ç”¨ `JSON.parse`ã€‚

```js title="rspack.config.mjs"
export default {
  module: {
    generator: {
      json: {
        JSONParse: false,
      },
    },
  },
};
```

## module.rules

æŸ¥çœ‹ [Module Rules](/config/module-rules) äº†è§£è¯¦æƒ…ã€‚
