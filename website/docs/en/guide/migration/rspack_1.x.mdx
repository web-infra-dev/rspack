# Migrating from Rspack 1.x

This document lists all breaking changes from Rspack v1.x to v2.0. You can refer to this document for migration.

> See [Breaking changes in Rspack v2.0](https://github.com/web-infra-dev/rspack/discussions/9270) for more details.

## Prerequisites

### Node.js Version Requirements

Rspack 2.0 has upgraded the minimum Node.js version from 16.x to **18.12.0**.

Before upgrading, please ensure your Node.js version meets the requirement:

```bash
node -v
# Should output v18.12.0 or higher
```

### Dependency Updates

If you are using `@rspack/dev-server`, it is now an optional peer dependency. You need to install it manually when using the `rspack serve` or `rspack preview` command:

```bash
pnpm add -D @rspack/dev-server
# or
npm install --save-dev @rspack/dev-server
# or
yarn add -D @rspack/dev-server
```

## Configuration Default Value Adjustments

In Rspack 2.0, we have adjusted the default values of multiple configuration options.

### [Important] Remove experiments.css

The `experiments.css` configuration has been removed, and CSS processing capability is now available by default.

In Rspack 1.x, you needed to set `experiments.css: true` to enable CSS processing capability.

In Rspack 2.0, CSS processing capability is available by default, but you still need to explicitly configure `module.rules` to handle CSS files:

```js title="rspack.config.mjs"
export default {
  module: {
    rules: [
      {
        test: /\.css$/,
        type: 'css/auto', // Auto-detect CSS Modules
      },
    ],
  },
};
```

#### CSS Type Explanation

- **`css`**: Treat CSS as pure CSS without CSS Modules
- **`css/module`**: Force enable CSS Modules
- **`css/auto`**: Auto-detect, enable CSS Modules for `.module.css` files, and treat regular `.css` files as pure CSS

### [Important] WebAssembly Support Enabled by Default

The default value of [experiments.asyncWebAssembly](/config/experiments#experimentsasyncwebassembly) has been changed from `false` to `true`.

In Rspack 2.0, async WebAssembly support is enabled by default, allowing the use of `type: 'webassembly/async'`.

Usage example:

```js title="rspack.config.mjs"
export default {
  module: {
    rules: [
      {
        test: /\.wasm$/,
        type: 'webassembly/async',
      },
    ],
  },
};
```

If you don't need this feature, you can explicitly disable it:

```js title="rspack.config.mjs"
export default {
  experiments: {
    asyncWebAssembly: false,
  },
};
```

### Global Variable Name Changes

To better identify Rspack, we have changed the default global variable names and default values from `webpack` prefix to `rspack` prefix.

#### output.chunkLoadingGlobal

The default value of [output.chunkLoadingGlobal](/config/output#outputchunkloadingglobal) has been changed from `webpackChunk${output.uniqueName}` to `rspackChunk${output.uniqueName}`.

If your application depends on specific global variable names (e.g., referencing them directly in HTML), you need to explicitly configure them:

```js title="rspack.config.mjs"
export default {
  output: {
    chunkLoadingGlobal: 'webpackChunkMyApp',
  },
};
```

#### output.hotUpdateGlobal

The default value of [output.hotUpdateGlobal](/config/output#outputhotupdateglobal) has been changed from `webpackHotUpdate${output.uniqueName}` to `rspackHotUpdate${output.uniqueName}`.

#### output.trustedTypes.policyName

The fallback value of [output.trustedTypes.policyName](/config/output#outputtrustedtypespolicyname) has been changed from `'webpack'` to `'rspack'`.

The default value of `policyName` is `output.uniqueName`, and the fallback value is only used when `uniqueName` is not set.

If your project does not set `uniqueName` and depends on a specific Trusted Types policy name, you need to update your CSP configuration or explicitly set it:

```js title="rspack.config.mjs"
export default {
  output: {
    trustedTypes: {
      policyName: 'webpack',
    },
  },
};
```

### Loader and Plugin Target Derivation

In Rspack 2.0, the `target` configuration of loaders and plugins now defaults to being derived from the [target](/config/target) configuration.

This affects the behavior of built-in loaders like `builtin:swc-loader`. For example, when `target: 'node'`, `builtin:swc-loader` will automatically use configurations suitable for the Node.js environment.

If you need to explicitly control the loader's target, you can configure it in the loader options:

```js title="rspack.config.mjs"
export default {
  target: 'node',
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'builtin:swc-loader',
        options: {
          env: {
            targets: 'chrome >= 87',
          },
        },
      },
    ],
  },
};
```

### Stats.toJson() Default Values

When calling `stats.toJson()` without parameters, the default values of the following fields have been changed to `false`:

- `modules` - Module information
- `assets` - Asset information
- `chunks` - Chunk information
- `chunkGroups` - Chunk group information
- `entryPoints` - Entry point information

This means that when calling `stats.toJson()`, these detailed information are no longer included by default, making the returned object more concise.

If you need to get detailed information, you can explicitly pass parameters when calling `toJson()`:

```js
const statsData = stats.toJson({
  modules: true,
  assets: true,
  chunks: true,
  chunkGroups: true,
  entryPoints: true,
});
```

### Parser Default Behavior

#### require as Expression

The default value of `parser.javascript.requireAsExpression` has been changed to `false`.

This means `require` is no longer parsed as an expression, and some dynamic usage may no longer work. To enable it, explicitly configure:

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireAsExpression: true,
      },
    },
  },
};
```

#### require Renaming

The require renaming resolution feature is disabled by default.

If your code uses patterns like `const req = require; req('./module')`, you may need to explicitly enable it:

```js title="rspack.config.mjs"
export default {
  module: {
    parser: {
      javascript: {
        requireAlias: true,
      },
    },
  },
};
```

## Configuration Migration and Reorganization

### [Important] experiments.cache Moved to cache

The `experiments.cache` configuration has been moved to the top-level [cache](/config/cache) configuration.

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    cache: {
-      type: 'filesystem',
-      buildDependencies: {
-        config: [__filename],
-      },
-    },
-  },
+  cache: {
+    type: 'filesystem',
+    buildDependencies: {
+      config: [__filename],
+    },
+  },
};
```

### [Important] experiments.rspackFuture Removed, bundlerInfo Moved to output

The `experiments.rspackFuture` configuration has been removed, and the `bundlerInfo` option has been moved to [output.bundlerInfo](/config/output#outputbundlerinfo).

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    rspackFuture: {
-      bundlerInfo: {
-        version: '1.0.0',
-      },
-    },
-  },
+  output: {
+    bundlerInfo: {
+      version: '1.0.0',
+    },
+  },
};
```

### experiments.incremental Moved to incremental

The `experiments.incremental` configuration has been moved to the top-level [incremental](/config/incremental) configuration.

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    incremental: {
-      make: true,
-      emitAssets: true,
-    },
-  },
+  incremental: {
+    make: true,
+    emitAssets: true,
+  },
};
```

## Removed Configuration Options

### Removed experiments Configurations

#### experiments.layers

The layer feature is now stable and enabled by default, and the `experiments.layers` configuration has been removed.

If you previously explicitly enabled this feature:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    layers: true,
-  },
};
```

You can now remove this configuration, and the layer feature will be automatically available.

Usage example:

```js title="rspack.config.mjs"
export default {
  module: {
    rules: [
      {
        test: /\.css$/,
        type: 'css/auto',
        layer: 'styles', // Put CSS modules in the 'styles' layer
      },
      {
        test: /\.js$/,
        layer: 'app', // Put JS modules in the 'app' layer
      },
    ],
  },
};
```

#### experiments.topLevelAwait

Top-level await is now stable and enabled by default, and the `experiments.topLevelAwait` configuration has been removed.

If you previously explicitly enabled this feature:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    topLevelAwait: true,
-  },
};
```

You can now remove this configuration, and top-level await in ESM modules will work automatically.

Usage example:

```js title="config.mjs"
// Use await directly at the module top level
const response = await fetch('https://api.example.com/config');
const config = await response.json();

export default config;
```

```js title="index.js"
// Import a module that uses top-level await
import config from './config.mjs';

console.log(config);
```

#### experiments.lazyCompilation

The `experiments.lazyCompilation` configuration has been removed, and the lazy compilation configuration has been moved to the root [lazyCompilation](/config/lazy-compilation) configuration.

Migration example:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    lazyCompilation: true,
-  },
+  lazyCompilation: true,
};
```

Or use object configuration:

```js title="rspack.config.mjs"
export default {
  lazyCompilation: {
    entries: true,
    imports: true,
  },
};
```

Please refer to the [lazy compilation documentation](/config/lazy-compilation) for detailed configuration options.

#### experiments.lazyBarrel

The `experiments.lazyBarrel` configuration has been removed because this optimization is now enabled by default.

If you previously explicitly enabled this feature:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    lazyBarrel: true,
-  },
};
```

You can now remove this configuration, and the lazy loading optimization for barrel files will take effect automatically.

#### experiments.typeReexportsPresence

The `experiments.typeReexportsPresence` experimental feature has been removed.

Type re-export handling is now controlled by default behavior and requires no additional configuration:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    typeReexportsPresence: true,
-  },
};
```

#### experiments.parallelLoader

The `experiments.parallelLoader` experimental feature has been removed.

The parallel loader processing feature is now stable and no longer needs to be enabled via `experiments`. If you want a loader to run in parallel, simply add `parallel: true` to the loader configuration:

```diff title="rspack.config.mjs"
export default {
-  experiments: {
-    parallelLoader: true,
-  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            loader: './my-loader.js',
+           parallel: true,
            options: {},
          },
        ],
      },
    ],
  },
};
```

#### experiments.SubResourceIntegrityPlugin

The `experiments.SubResourceIntegrityPlugin` configuration has been removed, and the plugin has been moved to the root configuration as the standalone `SubresourceIntegrityPlugin`.

Migration example:

```diff title="rspack.config.mjs"
+ import { SubresourceIntegrityPlugin } from '@rspack/core';
+
export default {
+  output: {
+    crossOriginLoading: 'anonymous',
+  },
-  experiments: {
-    SubResourceIntegrityPlugin: true,
-  },
+  plugins: [
+    new SubresourceIntegrityPlugin({
+      hashFuncNames: ['sha384'],
+    }),
+  ],
};
```

Please refer to the [SubresourceIntegrityPlugin documentation](/plugins/rspack/subresource-integrity-plugin) for detailed configuration options.

### Removed output Configuration

#### output.charset

The `output.charset` configuration has been removed.

This option was used to add the `charset` attribute to generated `<script>` tags, but modern browsers now default to UTF-8 encoding and no longer require this attribute.

If you previously set this configuration:

```diff title="rspack.config.mjs"
export default {
  output: {
-    charset: true,
  },
};
```

You can now remove it directly, and browsers will automatically use UTF-8 encoding.

### Removed stats and profile Configuration

#### profile and stats.profile

The top-level `profile` configuration and `stats.profile` configuration have been removed.

These options were used to collect performance profiling data during the build process, but their functionality was limited and the output was not intuitive enough.

If you previously enabled these configurations:

```diff title="rspack.config.mjs"
export default {
-  profile: true,
  stats: {
-    profile: true,
  },
};
```

It is recommended to use more professional performance analysis tools:

- [Rsdoctor](/guide/optimization/use-rsdoctor) - Official Rspack recommended performance analysis tool, providing a visual interface and detailed performance reports
- Chrome DevTools Performance panel - Analyze runtime performance
- Node.js built-in profiler - Use `--prof` and `--prof-process` to analyze Node.js level performance

## builtin:swc-loader Adjustments

### verbatimModuleSyntax Enabled by Default

The default value of the `verbatimModuleSyntax` option in `builtin:swc-loader` has been changed from `false` to `true`.

This affects the behavior of type imports/exports. TypeScript will preserve the original syntax of import/export statements without performing additional transformations.

If you need the old behavior, you can explicitly set it to `false`:

```js title="rspack.config.mjs"
export default {
  module: {
    rules: [
      {
        test: /\.ts$/,
        loader: 'builtin:swc-loader',
        options: {
          jsc: {
            parser: {
              syntax: 'typescript',
            },
            transform: {
              verbatimModuleSyntax: false,
            },
          },
        },
      },
    ],
  },
};
```

**Behavior Example:**

When `verbatimModuleSyntax: true` (default), you must explicitly distinguish between type imports and value imports:

```ts
// ✅ Correct: Explicitly marked as type import
import type { User } from './types';
import { fetchUser } from './api';

// ❌ Error: If User is only a type, this will cause a runtime error
import { User, fetchUser } from './module';
```

When `verbatimModuleSyntax: false`, TypeScript will automatically infer and remove pure type imports:

```ts
// TypeScript will automatically recognize User as a type and remove it after compilation
import { User, fetchUser } from './module';
```

It is recommended to use the default `verbatimModuleSyntax: true`, as it can detect type import issues earlier and avoid runtime errors.

### .swcrc Reading Disabled

Reading `.swcrc` files in the JavaScript compiler is disabled by default.

In Rspack 1.x, if a `.swcrc` file exists in the project root directory, it would be automatically read and applied.

In Rspack 2.0, `.swcrc` files are no longer automatically read. You need to migrate your SWC configuration to the loader options in `rspack.config.js`:

```js title="rspack.config.mjs"
export default {
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'builtin:swc-loader',
        options: {
          jsc: {
            parser: {
              syntax: 'ecmascript',
              jsx: true,
            },
            transform: {
              react: {
                runtime: 'automatic',
              },
            },
          },
        },
      },
    ],
  },
};
```

## Plugin-Related Changes

### EsmLibraryPlugin No Longer Exposed Directly

`rspack.EsmLibraryPlugin` is no longer exposed as a public API.

If you previously used `EsmLibraryPlugin`, you should now use the configuration approach:

```diff title="rspack.config.mjs"
-import { EsmLibraryPlugin } from '@rspack/core';
-
export default {
-  plugins: [new EsmLibraryPlugin()],
+  output: {
+    library: {
+      type: 'modern-module',
+    },
+  },
};
```

### Removed Plugins

#### WarnCaseSensitiveModulesPlugin

The `WarnCaseSensitiveModulesPlugin` plugin has been removed.

If you need to detect case-sensitive module reference issues, use `CaseSensitivePlugin` instead:

```diff title="rspack.config.mjs"
+ import { rspack } from '@rspack/core';
+
export default {
  plugins: [
-    new rspack.WarnCaseSensitiveModulesPlugin(),
+    new rspack.CaseSensitivePlugin(),
  ],
};
```

Please refer to the [CaseSensitivePlugin documentation](/plugins/webpack/case-sensitive-plugin) for detailed configuration options.

### Removed Plugin Methods

#### Plugin getHooks Method

The plugin's `getHooks` method has been removed, please use `getCompilationHooks` instead.

Migration example:

```diff title="my-plugin.js"
class MyPlugin {
  apply(compiler) {
    compiler.hooks.compilation.tap('MyPlugin', (compilation) => {
-      const hooks = compiler.HtmlRspackPlugin.getHooks(compilation);
+      const hooks = compiler.HtmlRspackPlugin.getCompilationHooks(compilation);
      
      hooks.beforeEmit.tap('MyPlugin', (data, cb) => {
        // ...
      });
    });
  }
}
```

### HtmlRspackPlugin Adjustments

The following options of [HtmlRspackPlugin](/plugins/rspack/html-rspack-plugin) have been removed:

- **`sri`** - The SRI (Subresource Integrity) option has been removed

If you need SRI functionality, consider using other solutions or custom plugins.

### LightningCssMinimizerRspackPlugin Adjustments

The following options of [LightningCssMinimizerRspackPlugin](/plugins/rspack/lightning-css-minimizer-rspack-plugin) have been removed or renamed:

#### draft Option

The `draft` option has been removed, please use `drafts` instead.

Migration example:

```diff title="rspack.config.mjs"
import { LightningCssMinimizerRspackPlugin } from '@rspack/core';

export default {
  optimization: {
    minimizer: [
      new LightningCssMinimizerRspackPlugin({
-       draft: {
-         customMedia: true,
-       },
+       drafts: {
+         customMedia: true,
+       },
      }),
    ],
  },
};
```

#### cssHeadDataCompression Option

The `cssHeadDataCompression` option has been removed because it was not actually used.

If you previously configured this option:

```diff title="rspack.config.mjs"
import { LightningCssMinimizerRspackPlugin } from '@rspack/core';

export default {
  optimization: {
    minimizer: [
      new LightningCssMinimizerRspackPlugin({
-       cssHeadDataCompression: true,
      }),
    ],
  },
};
```

You can simply remove this configuration, and it will not affect the build results.

### Runtime Module Deprecated Properties

The following deprecated properties of runtime modules have been removed:

- `constructorName` - Constructor name property
- `moduleIdentifier` - Module identifier property

If you use these properties in custom plugins, you need to update your code:

```diff title="my-plugin.js"
class MyPlugin {
  apply(compiler) {
    compiler.hooks.compilation.tap('MyPlugin', (compilation) => {
      compilation.hooks.runtimeModule.tap('MyPlugin', (module) => {
-       const name = module.constructorName;
-       const id = module.moduleIdentifier;
+       // Use alternative methods to get module information
+       const name = module.constructor.name;
+       const id = module.identifier();
      });
    });
  }
}
```